<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Vue.js -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .message-bot {
            @apply bg-gray-100 text-gray-800 rounded-lg rounded-tl-none p-3 self-start max-w-[80%];
        }
        
        .message-user {
            @apply gradient-bg text-white rounded-lg rounded-tr-none p-3 self-end max-w-[80%];
        }
        
        .avatar-selected {
            @apply ring-4 ring-purple-500;
        }

        .avatar-locked {
            filter: grayscale(100%);
            opacity: 0.5;
        }

        .goal-progress {
            transition: width 0.3s ease;
        }

        .rating-1 { background: linear-gradient(135deg, #cd7f32 0%, #b87333 100%); } /* –ë—Ä–æ–Ω–∑–∞ */
        .rating-2 { background: linear-gradient(135deg, #c0c0c0 0%, #a8a8a8 100%); } /* –°–µ—Ä–µ–±—Ä–æ */
        .rating-3 { background: linear-gradient(135deg, #ffd700 0%, #ffb347 100%); } /* –ó–æ–ª–æ—Ç–æ */
        .rating-4 { background: linear-gradient(135deg, #e5e4e2 0%, #d3d3d3 100%); } /* –ü–ª–∞—Ç–∏–Ω–∞ */
        .rating-5 { background: linear-gradient(135deg, #50c878 0%, #2e8b57 100%); } /* –ò–∑—É–º—Ä—É–¥ */

        .current-user-row {
            background: linear-gradient(135deg, #667eea40 0%, #764ba240 100%);
            border-left: 4px solid #667eea;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app">
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav class="gradient-bg text-white shadow-lg">
            <div class="container mx-auto px-4 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-wallet text-2xl"></i>
                        <span class="text-xl font-bold">–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç</span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div v-if="currentUser" class="flex items-center space-x-2">
                            <div class="w-8 h-8 rounded-full overflow-hidden border-2 border-white">
                                <img :src="getAvatarUrl(currentUser.avatar)" :alt="currentUser.name" class="w-full h-full object-cover">
                            </div>
                            <span class="text-sm">{{ currentUser.nickname }}</span>
                            <span class="text-xs bg-white text-purple-600 px-2 py-1 rounded-full">{{ getUserRating(currentUser) }}</span>
                        </div>
                        <button v-if="currentUser" @click="logout" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">
                            <i class="fas fa-sign-out-alt mr-2"></i>–í—ã–π—Ç–∏
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
        <div v-if="message.show" :class="['fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg text-white', 
            message.type === 'success' ? 'bg-green-500' : 'bg-red-500']">
            {{ message.text }}
        </div>

        <!-- –§–æ—Ä–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –µ—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω) -->
        <div v-if="!currentUser" class="container mx-auto px-4 py-8">
            <div class="max-w-4xl mx-auto">
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <div class="p-6">
                        <h1 class="text-3xl font-bold text-center mb-8">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç</h1>
                        
                        <div class="grid md:grid-cols-2 gap-8">
                            <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
                            <div class="bg-gray-50 rounded-xl p-6">
                                <h2 class="text-2xl font-bold mb-6 text-purple-600">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
                                
                                <div class="mb-4">
                                    <label class="block text-gray-700 font-medium mb-2">–ò–º—è</label>
                                    <input v-model="registerForm.name" type="text" 
                                           class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-purple-500">
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-gray-700 font-medium mb-2">–§–∞–º–∏–ª–∏—è</label>
                                    <input v-model="registerForm.surname" type="text" 
                                           class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-purple-500">
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-gray-700 font-medium mb-2">–î–æ—Ö–æ–¥ –≤ –º–µ—Å—è—Ü</label>
                                    <input v-model="registerForm.income" type="number" 
                                           class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-purple-500">
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-gray-700 font-medium mb-2">–ù–∏–∫–Ω–µ–π–º (–¥–ª—è –ø–æ–∏—Å–∫–∞ –¥—Ä—É–∑–µ–π)</label>
                                    <input v-model="registerForm.nickname" type="text" 
                                           class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-purple-500"
                                           placeholder="@username">
                                    <p class="text-xs text-gray-500 mt-1">–î–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º</p>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-gray-700 font-medium mb-2">–õ–æ–≥–∏–Ω (–¥–ª—è –≤—Ö–æ–¥–∞)</label>
                                    <input v-model="registerForm.login" type="text" 
                                           class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-purple-500">
                                    <p class="text-xs text-gray-500 mt-1">–î–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º</p>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-gray-700 font-medium mb-2">–ü–∞—Ä–æ–ª—å</label>
                                    <input v-model="registerForm.password" type="password" 
                                           class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-purple-500">
                                </div>

                                <div class="mb-4">
                                    <label class="block text-gray-700 font-medium mb-2">–†–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</label>
                                    <p class="text-xs text-gray-500 mb-2">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –∫–∞—Ç–µ–≥–æ—Ä–∏—é (–ö–§–ì –±—É–¥–µ—Ç —Ä–∞—Å—Å—á–∏—Ç–∞–Ω)</p>
                                    
                                    <div class="grid grid-cols-2 gap-3">
                                        <div v-for="(value, category) in registerForm.expenses" :key="category" class="mb-2">
                                            <label class="block text-xs text-gray-600 mb-1">
                                                <i :class="['mr-1', categoryIcons[category]]"></i>
                                                {{ categoryNames[category] }}
                                            </label>
                                            <input v-model.number="registerForm.expenses[category]" type="number" min="0" 
                                                   class="w-full px-2 py-1 text-sm border rounded-lg focus:outline-none focus:border-purple-500">
                                        </div>
                                    </div>
                                </div>

                                <div class="mb-6">
                                    <label class="block text-gray-700 font-medium mb-2">–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤–∞—Ç–∞—Ä</label>
                                    <div class="grid grid-cols-5 gap-2">
                                        <div v-for="avatar in avatars" :key="avatar.id" 
                                             @click="selectRegisterAvatar(avatar)"
                                             class="relative cursor-pointer rounded-lg overflow-hidden border-2"
                                             :class="[
                                                 registerForm.avatar === avatar.id ? 'border-purple-500' : 'border-transparent',
                                                 !isAvatarAvailableForRegister(avatar) ? 'cursor-not-allowed' : ''
                                             ]">
                                            <img :src="getAvatarUrl(avatar.id)" 
                                                 :class="['w-full h-auto', !isAvatarAvailableForRegister(avatar) ? 'avatar-locked' : '']">
                                            <!-- –ó–∞–º–æ–∫ –¥–ª—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–≤–∞—Ç–∞—Ä–æ–≤ -->
                                            <div v-if="!isAvatarAvailableForRegister(avatar)" 
                                                 class="absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center">
                                                <i class="fas fa-lock text-white text-xl"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-2">
                                        <i class="fas fa-info-circle mr-1"></i>
                                        –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –∞–≤–∞—Ç–∞—Ä "–ù–æ–≤–∏—á–æ–∫". –û—Å—Ç–∞–ª—å–Ω—ã–µ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ –ø–æ–≤—ã—à–µ–Ω–∏–∏ –ö–§–ì.
                                    </p>
                                </div>
                                
                                <button @click="handleRegister" 
                                        class="w-full gradient-bg text-white py-3 rounded-lg font-semibold hover:shadow-lg">
                                    <i class="fas fa-user-plus mr-2"></i>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                                </button>
                            </div>
                            
                            <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
                            <div class="bg-gray-50 rounded-xl p-6">
                                <h2 class="text-2xl font-bold mb-6 text-purple-600">–í—Ö–æ–¥</h2>
                                
                                <div class="mb-4">
                                    <label class="block text-gray-700 font-medium mb-2">–õ–æ–≥–∏–Ω</label>
                                    <input v-model="loginForm.login" type="text" 
                                           class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-purple-500">
                                </div>
                                
                                <div class="mb-6">
                                    <label class="block text-gray-700 font-medium mb-2">–ü–∞—Ä–æ–ª—å</label>
                                    <input v-model="loginForm.password" type="password" 
                                           class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-purple-500">
                                </div>
                                
                                <button @click="handleLogin" 
                                        class="w-full gradient-bg text-white py-3 rounded-lg font-semibold hover:shadow-lg">
                                    <i class="fas fa-sign-in-alt mr-2"></i>–í–æ–π—Ç–∏
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π) -->
        <div v-else class="container mx-auto px-4 py-8">
            <!-- –¢–∞–±—ã -->
            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="flex flex-wrap border-b">
                    <button v-for="tab in tabs" :key="tab.id" 
                            @click="currentTab = tab.id"
                            :class="['flex items-center px-6 py-3 text-sm font-medium',
                                     currentTab === tab.id 
                                         ? 'text-purple-600 border-b-2 border-purple-600' 
                                         : 'text-gray-500 hover:text-gray-700']">
                        <i :class="['mr-2', tab.icon]"></i>
                        {{ tab.name }}
                    </button>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
                <div v-show="currentTab === 'profile'" class="p-6">
                    <h2 class="text-2xl font-bold mb-6">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h2>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="bg-gray-50 rounded-xl p-6">
                            <h3 class="text-lg font-semibold mb-4">–õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                            <div class="space-y-3">
                                <div class="flex items-center space-x-4 pb-2 border-b">
                                    <div class="w-16 h-16 rounded-full overflow-hidden">
                                        <img :src="getAvatarUrl(currentUser.avatar)" :alt="currentUser.name" class="w-full h-full object-cover">
                                    </div>
                                    <div>
                                        <span class="text-gray-600">–ê–≤–∞—Ç–∞—Ä:</span>
                                        <span class="font-semibold block">{{ getAvatarName(currentUser.avatar) }}</span>
                                    </div>
                                </div>
                                <div class="flex justify-between pb-2 border-b">
                                    <span class="text-gray-600">–ò–º—è:</span>
                                    <span class="font-semibold">{{ currentUser.name }} {{ currentUser.surname }}</span>
                                </div>
                                <div class="flex justify-between pb-2 border-b">
                                    <span class="text-gray-600">–ù–∏–∫–Ω–µ–π–º:</span>
                                    <span class="font-semibold text-purple-600">{{ currentUser.nickname }}</span>
                                </div>
                                <div class="flex justify-between pb-2 border-b">
                                    <span class="text-gray-600">–õ–æ–≥–∏–Ω:</span>
                                    <span class="font-semibold">{{ currentUser.login }}</span>
                                </div>
                                <div class="flex justify-between pb-2 border-b">
                                    <span class="text-gray-600">–î–æ—Ö–æ–¥:</span>
                                    <span class="font-semibold">{{ currentUser.income }} ‚ÇΩ</span>
                                    <button @click="editIncome" class="text-purple-600 hover:text-purple-800">
                                        <i class="fas fa-edit ml-2"></i>
                                    </button>
                                </div>
                                <div class="flex justify-between pb-2 border-b">
                                    <span class="text-gray-600">–ö–§–ì:</span>
                                    <span class="font-semibold text-purple-600">{{ kfg }}</span>
                                </div>
                                <div class="flex justify-between pb-2 border-b">
                                    <span class="text-gray-600">–†–µ–π—Ç–∏–Ω–≥:</span>
                                    <span class="font-semibold" :class="'rating-' + getUserRatingLevel(currentUser) + ' px-2 py-1 rounded-full text-white'">
                                        {{ getUserRating(currentUser) }}
                                    </span>
                                </div>
                                <div class="flex justify-between pb-2 border-b">
                                    <span class="text-gray-600">–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–≤–∞—Ç–∞—Ä—ã:</span>
                                    <span class="font-semibold">{{ unlockedAvatars.join(', ') }}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 rounded-xl p-6">
                            <h3 class="text-lg font-semibold mb-4">–ö—Ä–∞—Ç–∫–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                            <div class="space-y-4">
                                <div class="gradient-bg text-white rounded-lg p-4">
                                    <p class="text-sm opacity-90">–û–±—â–∏–π –¥–æ—Ö–æ–¥</p>
                                    <p class="text-2xl font-bold">{{ totalIncome }} ‚ÇΩ</p>
                                </div>
                                <div class="gradient-bg text-white rounded-lg p-4">
                                    <p class="text-sm opacity-90">–û–±—â–∏–µ —Ä–∞—Å—Ö–æ–¥—ã</p>
                                    <p class="text-2xl font-bold">{{ totalExpenses }} ‚ÇΩ</p>
                                </div>
                                <div class="gradient-bg text-white rounded-lg p-4">
                                    <p class="text-sm opacity-90">–û—Å—Ç–∞—Ç–æ–∫</p>
                                    <p class="text-2xl font-bold">{{ balance }} ‚ÇΩ</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤ -->
                <div v-show="currentTab === 'expenses'" class="p-6">
                    <h2 class="text-2xl font-bold mb-6">–†–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h2>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                        <div v-for="(value, category) in filteredExpenses" :key="category" class="bg-gray-50 rounded-lg p-4">
                            <label class="block text-gray-700 font-medium mb-2">
                                <i :class="['mr-1', categoryIcons[category]]"></i>
                                {{ categoryNames[category] }}
                            </label>
                            <input v-model.number="expenses[category]" type="number" min="0" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-purple-500">
                        </div>
                    </div>
                    <button @click="saveExpenses" class="mt-6 gradient-bg text-white px-8 py-3 rounded-lg font-semibold hover:shadow-lg">
                        <i class="fas fa-save mr-2"></i>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞—Å—Ö–æ–¥—ã
                    </button>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ü–µ–ª–µ–π -->
                <div v-show="currentTab === 'goals'" class="p-6">
                    <h2 class="text-2xl font-bold mb-6">–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ü–µ–ª–∏</h2>
                    
                    <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π —Ü–µ–ª–∏ -->
                    <div class="bg-gray-50 rounded-lg p-6 mb-6">
                        <h3 class="text-lg font-semibold mb-4">–ù–æ–≤–∞—è —Ü–µ–ª—å</h3>
                        <div class="grid md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">–ù–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏</label>
                                <input v-model="newGoal.name" type="text" 
                                       class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-purple-500"
                                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö—É–ø–∏—Ç—å –º–∞—à–∏–Ω—É">
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-2">–ù–µ–æ–±—Ö–æ–¥–∏–º–∞—è —Å—É–º–º–∞ (‚ÇΩ)</label>
                                <input v-model.number="newGoal.targetAmount" type="number" min="1" 
                                       class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-purple-500"
                                       placeholder="100000">
                            </div>
                            <div class="flex items-end">
                                <button @click="addGoal" 
                                        class="gradient-bg text-white px-6 py-2 rounded-lg font-semibold hover:shadow-lg">
                                    <i class="fas fa-plus-circle mr-2"></i>–î–æ–±–∞–≤–∏—Ç—å —Ü–µ–ª—å
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- –°–ø–∏—Å–æ–∫ —Ü–µ–ª–µ–π -->
                    <h3 class="text-lg font-semibold mb-3">–ú–æ–∏ —Ü–µ–ª–∏ ({{ goals.length }})</h3>
                    
                    <div v-if="goals.length === 0" class="bg-gray-50 rounded-lg p-8 text-center text-gray-500">
                        <i class="fas fa-bullseye text-4xl mb-3 opacity-50"></i>
                        <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ü–µ–ª–µ–π</p>
                        <p class="text-sm">–°–æ–∑–¥–∞–π—Ç–µ —Ü–µ–ª—å, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∫–æ–ø–∏—Ç—å</p>
                    </div>
                    
                    <div v-else class="space-y-4">
                        <div v-for="(goal, index) in goals" :key="index" 
                             class="bg-gray-50 rounded-lg p-4 hover:shadow-md transition">
                            
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <h4 class="font-semibold text-lg">{{ goal.name }}</h4>
                                    <p class="text-sm text-gray-600">
                                        –ù—É–∂–Ω–æ: {{ goal.targetAmount }} ‚ÇΩ ‚Ä¢ –ù–∞–∫–æ–ø–ª–µ–Ω–æ: {{ goal.currentAmount }} ‚ÇΩ
                                    </p>
                                </div>
                                <div class="flex space-x-2">
                                    <button @click="openAddToGoalModal(index)" 
                                            class="text-green-600 hover:text-green-800">
                                        <i class="fas fa-plus-circle text-xl"></i>
                                    </button>
                                    <button @click="openRemoveGoalModal(index)" 
                                            class="text-red-500 hover:text-red-700">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä -->
                            <div class="relative pt-1">
                                <div class="flex mb-2 items-center justify-between">
                                    <div>
                                        <span class="text-xs font-semibold inline-block text-purple-600">
                                            –ü—Ä–æ–≥—Ä–µ—Å—Å
                                        </span>
                                    </div>
                                    <div class="text-right">
                                        <span class="text-xs font-semibold inline-block text-purple-600">
                                            {{ Math.min(100, Math.round((goal.currentAmount / goal.targetAmount) * 100)) }}%
                                        </span>
                                    </div>
                                </div>
                                <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-purple-200">
                                    <div :style="{ width: Math.min(100, (goal.currentAmount / goal.targetAmount) * 100) + '%' }"
                                         class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-purple-600 goal-progress">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- –ö–Ω–æ–ø–∫–∏ –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è -->
                            <div class="flex space-x-2 mt-2">
                                <button @click="quickAddToGoal(index, 1000)" 
                                        class="text-xs bg-gray-200 hover:bg-gray-300 px-2 py-1 rounded">
                                    +1000 ‚ÇΩ
                                </button>
                                <button @click="quickAddToGoal(index, 5000)" 
                                        class="text-xs bg-gray-200 hover:bg-gray-300 px-2 py-1 rounded">
                                    +5000 ‚ÇΩ
                                </button>
                                <button @click="quickAddToGoal(index, 10000)" 
                                        class="text-xs bg-gray-200 hover:bg-gray-300 px-2 py-1 rounded">
                                    +10000 ‚ÇΩ
                                </button>
                                <span v-if="goal.currentAmount >= goal.targetAmount" 
                                      class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded ml-auto">
                                    <i class="fas fa-check-circle mr-1"></i>–¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞!
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- –°–æ–≤–µ—Ç—ã –ø–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—é —Ü–µ–ª–µ–π -->
                    <div class="bg-blue-50 rounded-lg p-4 mt-6">
                        <h4 class="font-semibold text-blue-700 mb-2">
                            <i class="fas fa-lightbulb mr-2"></i>–°–æ–≤–µ—Ç –ø–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—é —Ü–µ–ª–µ–π
                        </h4>
                        <p class="text-sm text-blue-600">
                            –ß—Ç–æ–±—ã –±—ã—Å—Ç—Ä–µ–µ –¥–æ—Å—Ç–∏—á—å —Ü–µ–ª–∏, –æ—Ç–∫–ª–∞–¥—ã–≤–∞–π—Ç–µ —á–∞—Å—Ç—å –¥–æ—Ö–æ–¥–∞ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –µ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è.
                            –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—Ç–∫–ª–∞–¥—ã–≤–∞—Ç—å –Ω–µ –º–µ–Ω–µ–µ 10-20% –æ—Ç –º–µ—Å—è—á–Ω–æ–≥–æ –¥–æ—Ö–æ–¥–∞.
                        </p>
                        <p class="text-sm text-blue-600 mt-2">
                            üìä –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫: {{ balance }} ‚ÇΩ
                        </p>
                        <p v-if="goals.length > 0" class="text-sm text-blue-600 mt-2">
                            üéØ –û–±—â–∞—è —Å—É–º–º–∞ —Ü–µ–ª–µ–π: {{ totalGoalsAmount }} ‚ÇΩ
                        </p>
                        <!-- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ä–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–∏ -->
                        <p v-if="goals.length > 0 && balance > 0" class="text-sm text-blue-600 mt-2">
                            ‚è±Ô∏è –ü—Ä–∏ —Ç–µ–∫—É—â–µ–º —Ç–µ–º–ø–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–π ({{ balance }} ‚ÇΩ/–º–µ—Å) –≤—Å–µ —Ü–µ–ª–∏ –±—É–¥—É—Ç –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã —á–µ—Ä–µ–∑ {{ Math.ceil((totalGoalsAmount - totalSaved) / balance) }} {{ getMonthWord(Math.ceil((totalGoalsAmount - totalSaved) / balance)) }}
                        </p>
                        <p v-else-if="goals.length > 0 && balance <= 0" class="text-sm text-orange-600 mt-2">
                            ‚ö†Ô∏è –£ –≤–∞—Å –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è. –°–æ–∫—Ä–∞—Ç–∏—Ç–µ —Ä–∞—Å—Ö–æ–¥—ã, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∫–æ–ø–∏—Ç—å –Ω–∞ —Ü–µ–ª–∏.
                        </p>
                    </div>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ -->
                <div v-show="currentTab === 'analytics'" class="p-6">
                    <h2 class="text-2xl font-bold mb-6">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="gradient-bg text-white rounded-lg p-4">
                            <p class="text-sm opacity-90">–û–±—â–∏–π –¥–æ—Ö–æ–¥</p>
                            <p class="text-2xl font-bold">{{ totalIncome }} ‚ÇΩ</p>
                        </div>
                        <div class="gradient-bg text-white rounded-lg p-4">
                            <p class="text-sm opacity-90">–û–±—â–∏–µ —Ä–∞—Å—Ö–æ–¥—ã</p>
                            <p class="text-2xl font-bold">{{ totalExpenses }} ‚ÇΩ</p>
                        </div>
                        <div class="gradient-bg text-white rounded-lg p-4">
                            <p class="text-sm opacity-90">–û—Å—Ç–∞—Ç–æ–∫</p>
                            <p class="text-2xl font-bold">{{ balance }} ‚ÇΩ</p>
                        </div>
                        <div class="gradient-bg text-white rounded-lg p-4">
                            <p class="text-sm opacity-90">–ö–§–ì</p>
                            <p class="text-2xl font-bold">{{ kfg }}</p>
                        </div>
                    </div>

                    <div class="bg-gray-50 rounded-lg p-4 mb-6">
                        <canvas id="expenseChart" style="height: 300px;"></canvas>
                    </div>

                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-3">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3>
                        <div class="space-y-2">
                            <div v-for="rec in recommendations" :key="rec" class="bg-white p-3 rounded-lg shadow-sm">
                                {{ rec }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞ —á–∞—Ç-–±–æ—Ç–∞ -->
                <div v-show="currentTab === 'chat'" class="p-6">
                    <h2 class="text-2xl font-bold mb-6">–ß–∞—Ç —Å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º —Å–æ–≤–µ—Ç–Ω–∏–∫–æ–º</h2>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="h-96 overflow-y-auto flex flex-col space-y-2 mb-4" ref="chatContainer">
                            <div v-for="(msg, index) in chatMessages" :key="index" 
                                 :class="msg.sender === 'bot' ? 'message-bot' : 'message-user'">
                                {{ msg.text }}
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <textarea v-model="chatInput" @keyup.enter="sendMessage" rows="2" class="flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:border-purple-500" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å..."></textarea>
                            <button @click="sendMessage" class="gradient-bg text-white px-6 rounded-lg font-semibold hover:shadow-lg">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞ –¥—Ä—É–∑–µ–π (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è) -->
                <div v-show="currentTab === 'friends'" class="p-6">
                    <h2 class="text-2xl font-bold mb-6">–î—Ä—É–∑—å—è –∏ —Ä–µ–π—Ç–∏–Ω–≥–∏</h2>
                    
                    <!-- –†–µ–π—Ç–∏–Ω–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ (–≤–∫–ª—é—á–∞—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è) -->
                    <div class="bg-gradient-to-r from-purple-600 to-indigo-600 rounded-lg p-4 mb-6 text-white">
                        <h3 class="text-lg font-semibold mb-3 text-white">üèÜ –†–µ–π—Ç–∏–Ω–≥ –ö–§–ì (–≤—ã –∏ –≤–∞—à–∏ –¥—Ä—É–∑—å—è)</h3>
                        <div class="space-y-2">
                            <div v-for="(participant, index) in ratingParticipants" :key="participant.login" 
                                 class="flex items-center justify-between rounded-lg p-2"
                                 :class="participant.isCurrentUser ? 'current-user-row' : 'bg-white bg-opacity-20'">
                                <div class="flex items-center space-x-3">
                                    <span class="font-bold text-lg w-6 text-white">{{ index + 1 }}</span>
                                    <div class="w-8 h-8 rounded-full overflow-hidden">
                                        <img :src="getAvatarUrl(participant.avatar)" class="w-full h-full object-cover">
                                    </div>
                                    <div>
                                        <span class="font-medium text-white">
                                            {{ participant.name }} {{ participant.isCurrentUser ? '(–í—ã)' : '' }}
                                        </span>
                                        <span class="text-xs text-white opacity-80 ml-2">{{ participant.nickname }}</span>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <span class="font-bold text-white">{{ participant.kfg }}</span>
                                    <span class="text-xs px-2 py-1 rounded-full text-white" :class="'rating-' + participant.ratingLevel">
                                        {{ participant.ratingName }}
                                    </span>
                                </div>
                            </div>
                            <div v-if="ratingParticipants.length === 0" class="text-center py-2 text-white opacity-80">
                                –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–∑–µ–π –¥–ª—è —Ä–µ–π—Ç–∏–Ω–≥–∞
                            </div>
                        </div>
                    </div>

                    <!-- –ü–æ–∏—Å–∫ –¥—Ä—É–∑–µ–π -->
                    <div class="bg-gray-50 rounded-lg p-4 mb-6">
                        <h3 class="text-lg font-semibold mb-3">–ù–∞–π—Ç–∏ –¥—Ä—É–≥–∞ –ø–æ –Ω–∏–∫–Ω–µ–π–º—É</h3>
                        <div class="flex space-x-2">
                            <input v-model="friendSearchQuery" type="text" 
                                   class="flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:border-purple-500" 
                                   placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º (–Ω–∞–ø—Ä–∏–º–µ—Ä: @username)">
                            <button @click="searchFriends" class="gradient-bg text-white px-6 py-2 rounded-lg font-semibold hover:shadow-lg">
                                <i class="fas fa-search mr-2"></i>–ü–æ–∏—Å–∫
                            </button>
                        </div>
                        
                        <div v-if="searchResults.length > 0" class="mt-4">
                            <h4 class="text-sm font-medium text-gray-600 mb-2">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞:</h4>
                            <div class="space-y-2">
                                <div v-for="user in searchResults" :key="user.login" 
                                     class="bg-white p-3 rounded-lg flex justify-between items-center border">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-8 h-8 rounded-full overflow-hidden">
                                            <img :src="getAvatarUrl(user.avatar)" class="w-full h-full object-cover">
                                        </div>
                                        <div>
                                            <span class="font-medium">{{ user.name }} {{ user.surname }}</span>
                                            <span class="text-sm text-gray-500 ml-2">{{ user.nickname }}</span>
                                        </div>
                                    </div>
                                    <button @click="addFriend(user)" 
                                            class="bg-green-500 text-white px-3 py-1 rounded-lg text-sm hover:bg-green-600">
                                        <i class="fas fa-user-plus mr-1"></i>–î–æ–±–∞–≤–∏—Ç—å
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div v-else-if="friendSearchQuery && searchPerformed" class="mt-4 text-gray-500 text-center py-4">
                            –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –Ω–∏–∫–Ω–µ–π–º–æ–º –Ω–µ –Ω–∞–π–¥–µ–Ω
                        </div>
                    </div>

                    <!-- –°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π —Å –∏—Ö –¥—Ä—É–∑—å—è–º–∏ -->
                    <h3 class="text-lg font-semibold mb-3">–ú–æ–∏ –¥—Ä—É–∑—å—è ({{ friends.length }})</h3>
                    
                    <div v-if="friends.length === 0" class="bg-gray-50 rounded-lg p-8 text-center text-gray-500">
                        <i class="fas fa-user-friends text-4xl mb-3 opacity-50"></i>
                        <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–∑–µ–π</p>
                        <p class="text-sm">–ù–∞–π–¥–∏—Ç–µ –¥—Ä—É–∑–µ–π –ø–æ –Ω–∏–∫–Ω–µ–π–º—É –≤—ã—à–µ</p>
                    </div>
                    
                    <div v-else class="space-y-3">
                        <div v-for="friend in friendsWithDetails" :key="friend.login" 
                             class="bg-gray-50 rounded-lg p-4 hover:shadow-md transition">
                            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥—Ä—É–≥–µ -->
                            <div class="flex justify-between items-center">
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 rounded-full overflow-hidden">
                                        <img :src="getAvatarUrl(friend.avatar)" :alt="friend.name" class="w-full h-full object-cover">
                                    </div>
                                    <div>
                                        <div class="flex items-center space-x-2">
                                            <span class="font-medium">{{ friend.name }} {{ friend.surname }}</span>
                                            <span class="text-xs px-2 py-1 rounded-full text-white" :class="'rating-' + getUserRatingLevel(friend)">
                                                {{ getUserRating(friend) }}
                                            </span>
                                        </div>
                                        <span class="text-sm text-gray-500">{{ friend.nickname }}</span>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <div class="text-right">
                                        <div class="text-sm text-gray-600">–ö–§–ì</div>
                                        <div class="font-bold text-purple-600">{{ friend.kfg }}</div>
                                    </div>
                                    <button @click="removeFriend(friend)" 
                                            class="text-red-500 hover:text-red-700">
                                        <i class="fas fa-user-minus"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- –î—Ä—É–∑—å—è –¥—Ä—É–≥–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å) -->
                            <div v-if="friend.friends && friend.friends.length > 0" class="mt-3 pl-13 border-t pt-2">
                                <p class="text-xs text-gray-500 mb-2">
                                    <i class="fas fa-users mr-1"></i>–î—Ä—É–∑—å—è {{ friend.name }} ({{ friend.friends.length }}):
                                </p>
                                <div class="flex flex-wrap gap-2">
                                    <div v-for="friendOfFriend in friend.friends.slice(0, 3)" :key="friendOfFriend.login" 
                                         class="flex items-center space-x-1 bg-white rounded-full px-2 py-1 text-xs">
                                        <div class="w-4 h-4 rounded-full overflow-hidden">
                                            <img :src="getAvatarUrl(friendOfFriend.avatar)" class="w-full h-full object-cover">
                                        </div>
                                        <span>{{ friendOfFriend.name }}</span>
                                    </div>
                                    <span v-if="friend.friends.length > 3" class="text-xs text-gray-500">
                                        –∏ –µ—â–µ {{ friend.friends.length - 3 }}
                                    </span>
                                </div>
                            </div>
                            <div v-else class="mt-3 pl-13 border-t pt-2">
                                <p class="text-xs text-gray-400">–ù–µ—Ç –æ–±—â–∏—Ö –¥—Ä—É–∑–µ–π</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞ –Ω–∞–≥—Ä–∞–¥ -->
                <div v-show="currentTab === 'rewards'" class="p-6">
                    <h2 class="text-2xl font-bold mb-6">–°–∏—Å—Ç–µ–º–∞ –Ω–∞–≥—Ä–∞–¥ –∏ –∞–≤–∞—Ç–∞—Ä–æ–≤</h2>
                    
                    <div class="bg-gray-50 rounded-lg p-4 mb-6">
                        <h3 class="text-lg font-semibold mb-2">–í–∞—à –ö–§–ì: <span class="text-purple-600">{{ kfg }}</span></h3>
                        <h3 class="text-lg font-semibold mb-2">–í–∞—à —Ä–µ–π—Ç–∏–Ω–≥: <span class="px-2 py-1 rounded-full text-white" :class="'rating-' + getUserRatingLevel(currentUser)">{{ getUserRating(currentUser) }}</span></h3>
                        <h3 class="text-lg font-semibold mb-2">–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–≤–∞—Ç–∞—Ä—ã: <span class="text-purple-600">{{ unlockedAvatars.join(', ') }}</span></h3>
                    </div>

                    <!-- –î–æ—Å—Ç—É–ø–Ω—ã–µ –∞–≤–∞—Ç–∞—Ä—ã -->
                    <div class="bg-gray-50 rounded-lg p-4 mb-6">
                        <h3 class="text-lg font-semibold mb-4">–ê–≤–∞—Ç–∞—Ä—ã</h3>
                        <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                            <div v-for="avatar in avatars" :key="avatar.id" 
                                 @click="changeAvatar(avatar)"
                                 class="relative cursor-pointer rounded-lg overflow-hidden border-2 p-2"
                                 :class="[
                                     isAvatarUnlocked(avatar) ? 'opacity-100 hover:border-purple-500' : 'opacity-50 cursor-not-allowed',
                                     currentUser.avatar === avatar.id ? 'border-purple-500' : 'border-gray-200'
                                 ]">
                                <img :src="getAvatarUrl(avatar.id)" 
                                     :class="['w-full h-auto mb-2', !isAvatarUnlocked(avatar) ? 'avatar-locked' : '']">
                                <div class="text-center">
                                    <p class="text-sm font-medium">{{ avatar.name }}</p>
                                    <p class="text-xs" :class="isAvatarUnlocked(avatar) ? 'text-green-600' : 'text-gray-500'">
                                        {{ getAvatarStatus(avatar) }}
                                    </p>
                                </div>
                                <div v-if="!isAvatarUnlocked(avatar)" 
                                     class="absolute inset-0 bg-black bg-opacity-20 flex items-center justify-center">
                                    <i class="fas fa-lock text-gray-600 text-2xl"></i>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                            <p class="text-sm text-blue-700">
                                <i class="fas fa-info-circle mr-1"></i>
                                –í—Å–µ –∞–≤–∞—Ç–∞—Ä—ã, –∫—Ä–æ–º–µ "–ù–æ–≤–∏—á–æ–∫", —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –ö–§–ì –Ω–∏–∂–µ —Ç—Ä–µ–±—É–µ–º–æ–≥–æ –ø–æ—Ä–æ–≥–∞.
                                –ù–æ–≤–∏—á–æ–∫ (–ö–§–ì 0), –≠–∫–æ–Ω–æ–º (–ö–§–ì 40), –ò–Ω–≤–µ—Å—Ç–æ—Ä (–ö–§–ì 70), –≠–∫—Å–ø–µ—Ä—Ç (–ö–§–ì 90), –ì—É—Ä—É (–ö–§–ì 100).
                            </p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div v-for="reward in rewards" :key="reward.id" 
                             @click="claimReward(reward)"
                             :class="['rounded-lg p-4 text-center cursor-pointer transition-transform hover:scale-105',
                                      reward.kfgRequired <= kfg 
                                          ? 'bg-gradient-to-br from-yellow-400 to-orange-400' 
                                          : 'bg-gradient-to-br from-gray-300 to-gray-400 opacity-75']">
                            <i :class="['fas', reward.icon, 'text-3xl mb-2 text-white']"></i>
                            <h4 class="font-bold text-white mb-1">{{ reward.name }}</h4>
                            <p class="text-xs text-white opacity-90 mb-2">{{ reward.description }}</p>
                            <span class="inline-block bg-white bg-opacity-20 text-white px-2 py-1 rounded-full text-xs">
                                –ö–§–ì: {{ reward.kfgRequired }}
                            </span>
                        </div>
                    </div>

                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-3">–ù–∞–∫–∞–∑–∞–Ω–∏—è</h3>
                        <div v-for="penalty in penalties" :key="penalty" class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-2">
                            {{ penalty }}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ—Ö–æ–¥–∞ -->
        <div v-if="showIncomeModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4">
                <h3 class="text-xl font-bold mb-4">–ò–∑–º–µ–Ω–∏—Ç—å –¥–æ—Ö–æ–¥</h3>
                <div class="mb-4">
                    <label class="block text-gray-700 font-medium mb-2">–ù–æ–≤—ã–π –¥–æ—Ö–æ–¥ –≤ –º–µ—Å—è—Ü (‚ÇΩ)</label>
                    <input v-model.number="newIncomeValue" type="number" min="0" 
                           class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-purple-500">
                </div>
                <div class="flex space-x-2">
                    <button @click="saveIncome" class="gradient-bg text-white px-6 py-2 rounded-lg font-semibold hover:shadow-lg flex-1">
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                    <button @click="closeIncomeModal" class="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg font-semibold hover:bg-gray-400">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—É–º–º—ã –∫ —Ü–µ–ª–∏ -->
        <div v-if="showAddToGoalModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4">
                <h3 class="text-xl font-bold mb-4">–î–æ–±–∞–≤–∏—Ç—å –∫ —Ü–µ–ª–∏ "{{ selectedGoalName }}"</h3>
                <div class="mb-4">
                    <label class="block text-gray-700 font-medium mb-2">–°—É–º–º–∞ (‚ÇΩ)</label>
                    <input v-model.number="addToGoalAmount" type="number" min="1" 
                           class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-purple-500"
                           placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É">
                </div>
                <div class="flex space-x-2">
                    <button @click="confirmAddToGoal" class="gradient-bg text-white px-6 py-2 rounded-lg font-semibold hover:shadow-lg flex-1">
                        –î–æ–±–∞–≤–∏—Ç—å
                    </button>
                    <button @click="closeAddToGoalModal" class="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg font-semibold hover:bg-gray-400">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ü–µ–ª–∏ -->
        <div v-if="showRemoveGoalModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4">
                <h3 class="text-xl font-bold mb-4">–£–¥–∞–ª–∏—Ç—å —Ü–µ–ª—å</h3>
                <p class="text-gray-600 mb-6">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ü–µ–ª—å "{{ selectedGoalNameForRemove }}"?</p>
                <div class="flex space-x-2">
                    <button @click="confirmRemoveGoal" class="bg-red-500 text-white px-6 py-2 rounded-lg font-semibold hover:bg-red-600 flex-1">
                        –£–¥–∞–ª–∏—Ç—å
                    </button>
                    <button @click="closeRemoveGoalModal" class="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg font-semibold hover:bg-gray-400">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, reactive, computed, watch, onMounted } = Vue;

        const app = createApp({
            setup() {
                // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                const currentTab = ref('profile');
                const message = reactive({ show: false, text: '', type: 'success' });
                
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                const users = ref([]);
                const currentUser = ref(null);
                
                // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ—Ö–æ–¥–∞
                const showIncomeModal = ref(false);
                const newIncomeValue = ref(0);
                
                // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫ —Ü–µ–ª–∏
                const showAddToGoalModal = ref(false);
                const selectedGoalIndex = ref(null);
                const selectedGoalName = ref('');
                const addToGoalAmount = ref(1000);
                
                // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ü–µ–ª–∏
                const showRemoveGoalModal = ref(false);
                const selectedGoalIndexForRemove = ref(null);
                const selectedGoalNameForRemove = ref('');
                
                // –§–æ—Ä–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                const loginForm = reactive({
                    login: '',
                    password: ''
                });
                
                // –ù–∞—á–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤ –¥–ª—è —Ñ–æ—Ä–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (—É–±—Ä–∞–Ω—ã –ø—É—Å—Ç—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ - —Ç–µ–ø–µ—Ä—å 11 –∫–∞—Ç–µ–≥–æ—Ä–∏–π)
                const initialExpenses = {
                    food: 0, 
                    transport: 0, 
                    cafe: 0,
                    hobby: 0, 
                    selfcare: 0,
                    health: 0, 
                    housing: 0, 
                    entertainment: 0,
                    subscriptions: 0, 
                    education: 0, 
                    travel: 0
                };
                
                const registerForm = reactive({
                    name: '',
                    surname: '',
                    nickname: '',
                    login: '',
                    password: '',
                    income: 0,
                    avatar: 1,
                    expenses: { ...initialExpenses }
                });
                
                // –†–∞—Å—Ö–æ–¥—ã (–¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è) - 11 –∫–∞—Ç–µ–≥–æ—Ä–∏–π
                const expenses = reactive({ ...initialExpenses });

                // –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ü–µ–ª–∏
                const goals = ref([]);
                const newGoal = reactive({
                    name: '',
                    targetAmount: 0
                });
                
                // –î—Ä—É–∑—å—è
                const friends = ref([]);
                const friendSearchQuery = ref('');
                const searchResults = ref([]);
                const searchPerformed = ref(false);
                
                // –ß–∞—Ç
                const chatMessages = ref([
                    { text: '–ü—Ä–∏–≤–µ—Ç! –Ø –≤–∞—à —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Å–æ–≤–µ—Ç–Ω–∏–∫. –ó–∞–¥–∞–π—Ç–µ –º–Ω–µ –≤–æ–ø—Ä–æ—Å –æ —Ñ–∏–Ω–∞–Ω—Å–∞—Ö –∏–ª–∏ –ø–æ–ø—Ä–æ—Å–∏—Ç–µ —Å–æ–≤–µ—Ç –ø–æ —ç–∫–æ–Ω–æ–º–∏–∏.', sender: 'bot' }
                ]);
                const chatInput = ref('');
                const chatContainer = ref(null);
                
                // –ù–∞–≥—Ä–∞–¥—ã
                const rewards = [
                    { id: 1, name: '–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫–æ—Ñ–µ', kfgRequired: 50, description: '–°–∫–∏–¥–∫–∞ 50% –Ω–∞ –∫–æ—Ñ–µ', icon: 'fa-coffee' },
                    { id: 2, name: '–ö–∏–Ω–æ –æ–Ω–ª–∞–π–Ω', kfgRequired: 100, description: '–ú–µ—Å—è—Ü –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä', icon: 'fa-film' },
                    { id: 3, name: '–ö–Ω–∏–≥–∞', kfgRequired: 150, description: '–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –∫–Ω–∏–≥–∞ –≤ –ø–æ–¥–∞—Ä–æ–∫', icon: 'fa-book' },
                    { id: 4, name: '–°–ø–æ—Ä—Ç–∑–∞–ª', kfgRequired: 200, description: '–ú–µ—Å—è—Ü –≤ —Å–ø–æ—Ä—Ç–∑–∞–ª –±–µ—Å–ø–ª–∞—Ç–Ω–æ', icon: 'fa-dumbbell' },
                    { id: 5, name: '–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ', kfgRequired: 300, description: '–°–∫–∏–¥–∫–∞ –Ω–∞ –±–∏–ª–µ—Ç—ã 20%', icon: 'fa-plane' }
                ];

                // –ê–≤–∞—Ç–∞—Ä—ã
                const avatars = [
                    { id: 1, name: '–ù–æ–≤–∏—á–æ–∫', kfgRequired: 0, isPermanent: true, icon: 'fa-user' },
                    { id: 2, name: '–≠–∫–æ–Ω–æ–º', kfgRequired: 40, isPermanent: false, icon: 'fa-piggy-bank' },
                    { id: 3, name: '–ò–Ω–≤–µ—Å—Ç–æ—Ä', kfgRequired: 70, isPermanent: false, icon: 'fa-chart-line' },
                    { id: 4, name: '–≠–∫—Å–ø–µ—Ä—Ç', kfgRequired: 90, isPermanent: false, icon: 'fa-crown' },
                    { id: 5, name: '–ì—É—Ä—É', kfgRequired: 100, isPermanent: false, icon: 'fa-gem' }
                ];
                
                // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
                const tabs = [
                    { id: 'profile', name: '–ü—Ä–æ—Ñ–∏–ª—å', icon: 'fas fa-user' },
                    { id: 'expenses', name: '–†–∞—Å—Ö–æ–¥—ã', icon: 'fas fa-chart-line' },
                    { id: 'goals', name: '–¶–µ–ª–∏', icon: 'fas fa-bullseye' },
                    { id: 'analytics', name: '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞', icon: 'fas fa-chart-pie' },
                    { id: 'chat', name: '–ß–∞—Ç-–±–æ—Ç', icon: 'fas fa-robot' },
                    { id: 'friends', name: '–î—Ä—É–∑—å—è', icon: 'fas fa-users' },
                    { id: 'rewards', name: '–ù–∞–≥—Ä–∞–¥—ã', icon: 'fas fa-gift' }
                ];
                
                // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤ (—Ç–µ–ø–µ—Ä—å 11 –∫–∞—Ç–µ–≥–æ—Ä–∏–π - —É–±—Ä–∞–Ω—ã –æ–¥–µ–∂–¥–∞ –∏ —Å–ø–æ—Ä—Ç)
                const categoryNames = {
                    food: '–ï–¥–∞',
                    transport: '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç',
                    cafe: '–ö–∞—Ñ–µ –∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã',
                    hobby: '–•–æ–±–±–∏',
                    selfcare: '–£—Ö–æ–¥',
                    health: '–ó–¥–æ—Ä–æ–≤—å–µ',
                    housing: '–ñ–∏–ª—å–µ',
                    entertainment: '–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è',
                    subscriptions: '–ü–æ–¥–ø–∏—Å–∫–∏',
                    education: '–£—á–µ–±–∞',
                    travel: '–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è'
                };
                
                const categoryIcons = {
                    food: 'fas fa-utensils',
                    transport: 'fas fa-bus',
                    cafe: 'fas fa-coffee',
                    hobby: 'fas fa-palette',
                    selfcare: 'fas fa-spa',
                    health: 'fas fa-heartbeat',
                    housing: 'fas fa-home',
                    entertainment: 'fas fa-gamepad',
                    subscriptions: 'fas fa-tv',
                    education: 'fas fa-book',
                    travel: 'fas fa-plane'
                };
                
                // –í—ã—á–∏—Å–ª—è–µ–º—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
                const totalExpenses = computed(() => {
                    return Object.values(expenses).reduce((a, b) => a + b, 0);
                });
                
                const totalIncome = computed(() => currentUser.value?.income || 0);
                
                const balance = computed(() => totalIncome.value - totalExpenses.value);

                // –û–±—â–∞—è —Å—É–º–º–∞ –≤—Å–µ—Ö —Ü–µ–ª–µ–π
                const totalGoalsAmount = computed(() => {
                    return goals.value.reduce((sum, goal) => sum + goal.targetAmount, 0);
                });

                // –û–±—â–∞—è –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–∞—è —Å—É–º–º–∞ –ø–æ –≤—Å–µ–º —Ü–µ–ª—è–º
                const totalSaved = computed(() => {
                    return goals.value.reduce((sum, goal) => sum + goal.currentAmount, 0);
                });

                // –§–∏–ª—å—Ç—Ä –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ä–∞—Å—Ö–æ–¥–æ–≤
                const filteredExpenses = computed(() => {
                    const filtered = {};
                    Object.keys(expenses).forEach(key => {
                        if (categoryNames[key]) {
                            filtered[key] = expenses[key];
                        }
                    });
                    return filtered;
                });
                
                // –§–æ—Ä–º—É–ª–∞ –ö–§–ì –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                function calculateKFG(user) {
                    if (!user?.income || user.income === 0) return 0;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ä–∞—Å—Ö–æ–¥—ã
                    const userExpenses = user.expenses || {};
                    const hasAnyExpenses = Object.values(userExpenses).some(val => val > 0);
                    if (!hasAnyExpenses) {
                        return 0;
                    }
                    
                    const totalUserExpenses = Object.values(userExpenses).reduce((a, b) => a + b, 0);
                    
                    let value = 100 - (totalUserExpenses / user.income * 100);
                    
                    // –®—Ç—Ä–∞—Ñ—ã
                    const totalFood = (userExpenses.food || 0) + (userExpenses.cafe || 0);
                    if (userExpenses.entertainment > user.income * 0.3) value -= 20;
                    if (totalFood > user.income * 0.5) value -= 15;
                    if (userExpenses.subscriptions > user.income * 0.1) value -= 10;
                    
                    // –ë–æ–Ω—É—Å—ã
                    if (userExpenses.education > 0) value += 5;
                    if ((user.income - totalUserExpenses) > user.income * 0.2) value += 10;
                    
                    return Math.max(0, Math.min(100, Math.round(value)));
                }

                // –ö–§–ì –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ç–µ–∫—É—â–∏—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤)
                const kfg = computed(() => {
                    if (!currentUser.value) return 0;
                    
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â–∏–µ —Ä–∞—Å—Ö–æ–¥—ã –∏–∑ —Ñ–æ—Ä–º—ã, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
                    const hasAnyExpenses = Object.values(expenses).some(val => val > 0);
                    if (!hasAnyExpenses) {
                        return 0;
                    }
                    
                    let value = 100 - (totalExpenses.value / currentUser.value.income * 100);
                    
                    // –®—Ç—Ä–∞—Ñ—ã
                    const totalFood = (expenses.food || 0) + (expenses.cafe || 0);
                    if (expenses.entertainment > currentUser.value.income * 0.3) value -= 20;
                    if (totalFood > currentUser.value.income * 0.5) value -= 15;
                    if (expenses.subscriptions > currentUser.value.income * 0.1) value -= 10;
                    
                    // –ë–æ–Ω—É—Å—ã
                    if (expenses.education > 0) value += 5;
                    if (balance.value > currentUser.value.income * 0.2) value += 10;
                    
                    return Math.max(0, Math.min(100, Math.round(value)));
                });

                // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–≤–∞—Ç–∞—Ä—ã
                const unlockedAvatars = computed(() => {
                    if (!currentUser.value) return [];
                    
                    const unlocked = [];
                    
                    avatars.forEach(avatar => {
                        if (avatar.id === 1) {
                            unlocked.push(avatar.name);
                        } else if (kfg.value >= avatar.kfgRequired) {
                            unlocked.push(avatar.name);
                        }
                    });
                    
                    return unlocked;
                });

                // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                function getUserRating(user) {
                    const userKFG = calculateKFG(user);
                    if (userKFG >= 90) return '–ì—É—Ä—É';
                    if (userKFG >= 70) return '–≠–∫—Å–ø–µ—Ä—Ç';
                    if (userKFG >= 50) return '–ò–Ω–≤–µ—Å—Ç–æ—Ä';
                    if (userKFG >= 30) return '–≠–∫–æ–Ω–æ–º';
                    return '–ù–æ–≤–∏—á–æ–∫';
                }

                function getUserRatingLevel(user) {
                    const userKFG = calculateKFG(user);
                    if (userKFG >= 90) return 5;
                    if (userKFG >= 70) return 4;
                    if (userKFG >= 50) return 3;
                    if (userKFG >= 30) return 2;
                    return 1;
                }

                // –î—Ä—É–∑—å—è —Å –∏—Ö –ö–§–ì –∏ –¥–µ—Ç–∞–ª—è–º–∏
                const friendsWithKFG = computed(() => {
                    return friends.value.map(friend => {
                        const fullUser = users.value.find(u => u.login === friend.login);
                        return {
                            ...friend,
                            kfg: fullUser ? calculateKFG(fullUser) : 0,
                            avatar: fullUser?.avatar || friend.avatar
                        };
                    }).sort((a, b) => b.kfg - a.kfg);
                });

                // –£—á–∞—Å—Ç–Ω–∏–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞ (—Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å + –¥—Ä—É–∑—å—è)
                const ratingParticipants = computed(() => {
                    if (!currentUser.value) return [];
                    
                    const participants = [];
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    participants.push({
                        ...currentUser.value,
                        kfg: kfg.value,
                        isCurrentUser: true,
                        ratingName: getUserRating(currentUser.value),
                        ratingLevel: getUserRatingLevel(currentUser.value)
                    });
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –¥—Ä—É–∑–µ–π
                    friends.value.forEach(friend => {
                        const fullUser = users.value.find(u => u.login === friend.login);
                        if (fullUser) {
                            participants.push({
                                ...friend,
                                kfg: calculateKFG(fullUser),
                                avatar: fullUser.avatar,
                                isCurrentUser: false,
                                ratingName: getUserRating(fullUser),
                                ratingLevel: getUserRatingLevel(fullUser)
                            });
                        }
                    });
                    
                    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –ö–§–ì (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)
                    return participants.sort((a, b) => b.kfg - a.kfg);
                });

                const friendsWithDetails = computed(() => {
                    return friends.value.map(friend => {
                        const fullUser = users.value.find(u => u.login === friend.login);
                        if (!fullUser) return friend;
                        
                        // –ü–æ–ª—É—á–∞–µ–º –¥—Ä—É–∑–µ–π –¥—Ä—É–≥–∞
                        const friendFriends = (fullUser.friends || []).map(f => {
                            const friendUser = users.value.find(u => u.login === f.login);
                            return {
                                ...f,
                                avatar: friendUser?.avatar || f.avatar
                            };
                        });
                        
                        return {
                            ...friend,
                            kfg: calculateKFG(fullUser),
                            avatar: fullUser.avatar,
                            friends: friendFriends
                        };
                    });
                });

                // –ü—Ä–æ–≤–µ—Ä–∫–∞, —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ª–∏ –∞–≤–∞—Ç–∞—Ä
                function isAvatarUnlocked(avatar) {
                    if (!currentUser.value) return false;
                    
                    if (avatar.id === 1) {
                        return true;
                    } else {
                        return kfg.value >= avatar.kfgRequired;
                    }
                }

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∞–≤–∞—Ç–∞—Ä–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
                function isAvatarAvailableForRegister(avatar) {
                    return avatar.id === 1;
                }

                function selectRegisterAvatar(avatar) {
                    if (isAvatarAvailableForRegister(avatar)) {
                        registerForm.avatar = avatar.id;
                    } else {
                        showMessage('–≠—Ç–æ—Ç –∞–≤–∞—Ç–∞—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏', 'error');
                    }
                }

                function getAvatarStatus(avatar) {
                    if (!currentUser.value) return '';
                    
                    if (avatar.id === 1) {
                        return '–í—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–µ–Ω';
                    } else {
                        if (kfg.value >= avatar.kfgRequired) {
                            return '–î–æ—Å—Ç—É–ø–µ–Ω';
                        } else {
                            return `–¢—Ä–µ–±—É–µ—Ç—Å—è –ö–§–ì ${avatar.kfgRequired}`;
                        }
                    }
                }

                // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫–ª–æ–Ω–µ–Ω–∏—è —Å–ª–æ–≤–∞ "–º–µ—Å—è—Ü"
                function getMonthWord(months) {
                    if (months % 10 === 1 && months % 100 !== 11) {
                        return '–º–µ—Å—è—Ü';
                    } else if ([2, 3, 4].includes(months % 10) && ![12, 13, 14].includes(months % 100)) {
                        return '–º–µ—Å—è—Ü–∞';
                    } else {
                        return '–º–µ—Å—è—Ü–µ–≤';
                    }
                }

                // –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ü–µ–ª—è–º–∏
                function addGoal() {
                    if (!newGoal.name.trim()) {
                        showMessage('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏', 'error');
                        return;
                    }
                    
                    if (newGoal.targetAmount <= 0) {
                        showMessage('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É —Ü–µ–ª–∏', 'error');
                        return;
                    }
                    
                    goals.value.push({
                        name: newGoal.name,
                        targetAmount: newGoal.targetAmount,
                        currentAmount: 0
                    });
                    
                    newGoal.name = '';
                    newGoal.targetAmount = 0;
                    
                    saveToStorage();
                    showMessage('–¶–µ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω–∞!', 'success');
                }

                function openAddToGoalModal(index) {
                    selectedGoalIndex.value = index;
                    selectedGoalName.value = goals.value[index].name;
                    addToGoalAmount.value = 1000;
                    showAddToGoalModal.value = true;
                }

                function closeAddToGoalModal() {
                    showAddToGoalModal.value = false;
                    selectedGoalIndex.value = null;
                    selectedGoalName.value = '';
                    addToGoalAmount.value = 1000;
                }

                function confirmAddToGoal() {
                    if (selectedGoalIndex.value === null) return;
                    
                    if (addToGoalAmount.value <= 0) {
                        showMessage('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É', 'error');
                        return;
                    }
                    
                    goals.value[selectedGoalIndex.value].currentAmount += addToGoalAmount.value;
                    saveToStorage();
                    showMessage(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${addToGoalAmount.value} ‚ÇΩ –∫ —Ü–µ–ª–∏!`, 'success');
                    closeAddToGoalModal();
                }

                function quickAddToGoal(index, amount) {
                    goals.value[index].currentAmount += amount;
                    saveToStorage();
                    showMessage(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${amount} ‚ÇΩ –∫ —Ü–µ–ª–∏!`, 'success');
                }

                function openRemoveGoalModal(index) {
                    selectedGoalIndexForRemove.value = index;
                    selectedGoalNameForRemove.value = goals.value[index].name;
                    showRemoveGoalModal.value = true;
                }

                function closeRemoveGoalModal() {
                    showRemoveGoalModal.value = false;
                    selectedGoalIndexForRemove.value = null;
                    selectedGoalNameForRemove.value = '';
                }

                function confirmRemoveGoal() {
                    if (selectedGoalIndexForRemove.value === null) return;
                    
                    goals.value.splice(selectedGoalIndexForRemove.value, 1);
                    saveToStorage();
                    showMessage('–¶–µ–ª—å —É–¥–∞–ª–µ–Ω–∞', 'success');
                    closeRemoveGoalModal();
                }
                
                const recommendations = computed(() => {
                    if (!currentUser.value) return [];
                    
                    const recs = [];
                    
                    if (totalExpenses.value > currentUser.value.income) {
                        recs.push('‚ö†Ô∏è –í–∞—à–∏ —Ä–∞—Å—Ö–æ–¥—ã –ø—Ä–µ–≤—ã—à–∞—é—Ç –¥–æ—Ö–æ–¥! –°—Ä–æ—á–Ω–æ —Å–æ–∫—Ä–∞—Ç–∏—Ç–µ —Ç—Ä–∞—Ç—ã.');
                    }
                    
                    if (expenses.entertainment > currentUser.value.income * 0.2) {
                        recs.push('üéØ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–æ 20% –æ—Ç –¥–æ—Ö–æ–¥–∞.');
                    }
                    
                    const totalFood = (expenses.food || 0) + (expenses.cafe || 0);
                    if (totalFood > currentUser.value.income * 0.3) {
                        recs.push('üçé –ì–æ—Ç–æ–≤—å—Ç–µ –¥–æ–º–∞ —á–∞—â–µ - —ç—Ç–æ —Å—ç–∫–æ–Ω–æ–º–∏—Ç –¥–æ 50% –Ω–∞ –µ–¥–µ –∏ –∫–∞—Ñ–µ.');
                    }
                    
                    if (expenses.subscriptions > 1000) {
                        recs.push('üì± –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–ø–∏—Å–∫–∏ - –≤–æ–∑–º–æ–∂–Ω–æ, –≤—ã –ø–ª–∞—Ç–∏—Ç–µ –∑–∞ –Ω–µ–Ω—É–∂–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã.');
                    }
                    
                    if (expenses.education === 0) {
                        recs.push('üìö –ò–Ω–≤–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ - —ç—Ç–æ –ø–æ–≤—ã—Å–∏—Ç –≤–∞—à –±—É–¥—É—â–∏–π –¥–æ—Ö–æ–¥.');
                    }
                    
                    if (balance.value > 0) {
                        recs.push(`üí™ –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –í—ã –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ—Ç–µ ${balance.value} ‚ÇΩ –≤ –º–µ—Å—è—Ü.`);
                    }

                    if (goals.value.length > 0) {
                        const totalNeeded = totalGoalsAmount.value;
                        const totalSavedVal = totalSaved.value;
                        if (totalSavedVal < totalNeeded) {
                            const remaining = totalNeeded - totalSavedVal;
                            recs.push(`üéØ –î–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –≤—Å–µ—Ö —Ü–µ–ª–µ–π –æ—Å—Ç–∞–ª–æ—Å—å –Ω–∞–∫–æ–ø–∏—Ç—å ${remaining} ‚ÇΩ`);
                        }
                    }
                    
                    return recs;
                });
                
                const penalties = computed(() => {
                    if (!currentUser.value) return [];
                    
                    const pens = [];
                    
                    if (kfg.value < 30) {
                        pens.push('‚ö†Ô∏è –í–∞—à –ö–§–ì –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∏–π! –£–≤–µ–ª–∏—á—å—Ç–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å.');
                    }
                    
                    if (totalExpenses.value > currentUser.value.income * 0.9) {
                        pens.push('üìâ –í—ã —Ç—Ä–∞—Ç–∏—Ç–µ –ø–æ—á—Ç–∏ –≤–µ—Å—å –¥–æ—Ö–æ–¥ - —Å—Ä–æ—á–Ω–æ —Å–æ–∫—Ä–∞—Ç–∏—Ç–µ —Ä–∞—Å—Ö–æ–¥—ã!');
                    }
                    
                    return pens;
                });
                
                // –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–æ—Ö–æ–¥–æ–º
                function editIncome() {
                    newIncomeValue.value = currentUser.value.income;
                    showIncomeModal.value = true;
                }

                function closeIncomeModal() {
                    showIncomeModal.value = false;
                    newIncomeValue.value = 0;
                }

                function saveIncome() {
                    if (newIncomeValue.value < 0) {
                        showMessage('–î–æ—Ö–æ–¥ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º', 'error');
                        return;
                    }

                    const userIndex = users.value.findIndex(u => u.login === currentUser.value?.login);
                    if (userIndex !== -1) {
                        users.value[userIndex].income = newIncomeValue.value;
                        currentUser.value.income = newIncomeValue.value;
                        saveToStorage();
                        showMessage('–î–æ—Ö–æ–¥ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!', 'success');
                        closeIncomeModal();
                    }
                }
                
                // –ú–µ—Ç–æ–¥—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                function handleRegister() {
                    if (!registerForm.name || !registerForm.surname || !registerForm.nickname || 
                        !registerForm.login || !registerForm.password || !registerForm.income) {
                        showMessage('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                        return;
                    }
                    
                    if (users.value.some(u => u.login === registerForm.login)) {
                        showMessage('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –ª–æ–≥–∏–Ω–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', 'error');
                        return;
                    }
                    
                    if (users.value.some(u => u.nickname === registerForm.nickname)) {
                        showMessage('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –Ω–∏–∫–Ω–µ–π–º–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', 'error');
                        return;
                    }
                    
                    if (registerForm.avatar !== 1) {
                        showMessage('–ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –∞–≤–∞—Ç–∞—Ä "–ù–æ–≤–∏—á–æ–∫"', 'error');
                        registerForm.avatar = 1;
                        return;
                    }
                    
                    const hasExpenses = Object.values(registerForm.expenses).some(val => val > 0);
                    if (!hasExpenses) {
                        showMessage('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ä–∞—Å—Ö–æ–¥–æ–≤', 'error');
                        return;
                    }
                    
                    const newUser = {
                        name: registerForm.name,
                        surname: registerForm.surname,
                        nickname: registerForm.nickname,
                        login: registerForm.login,
                        password: registerForm.password,
                        income: Number(registerForm.income),
                        avatar: registerForm.avatar,
                        expenses: { ...registerForm.expenses },
                        goals: [],
                        friends: []
                    };
                    
                    users.value.push(newUser);
                    currentUser.value = { ...newUser };
                    
                    Object.assign(expenses, registerForm.expenses);
                    
                    showMessage('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!', 'success');
                    
                    registerForm.name = '';
                    registerForm.surname = '';
                    registerForm.nickname = '';
                    registerForm.login = '';
                    registerForm.password = '';
                    registerForm.income = 0;
                    registerForm.avatar = 1;
                    Object.assign(registerForm.expenses, initialExpenses);
                    
                    saveToStorage();
                }
                
                function handleLogin() {
                    if (!loginForm.login || !loginForm.password) {
                        showMessage('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                        return;
                    }
                    
                    const user = users.value.find(u => 
                        u.login === loginForm.login && u.password === loginForm.password
                    );
                    
                    if (user) {
                        currentUser.value = { ...user };
                        loadUserData(user);
                        showMessage('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!', 'success');
                        
                        loginForm.login = '';
                        loginForm.password = '';
                    } else {
                        showMessage('–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å', 'error');
                    }
                }
                
                function logout() {
                    currentUser.value = null;
                    
                    Object.assign(expenses, initialExpenses);
                    goals.value = [];
                    friends.value = [];
                    
                    showMessage('–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'success');
                }
                
                function loadUserData(user) {
                    if (user.expenses) {
                        Object.assign(expenses, user.expenses);
                    }
                    
                    if (user.goals) {
                        goals.value = user.goals;
                    }
                    
                    if (user.friends) {
                        friends.value = user.friends;
                    }
                    
                    updateChart();
                }
                
                // –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥—Ä—É–∑—å—è–º–∏
                function searchFriends() {
                    searchPerformed.value = true;
                    
                    if (!friendSearchQuery.value.trim()) {
                        searchResults.value = [];
                        return;
                    }
                    
                    const query = friendSearchQuery.value.toLowerCase();
                    
                    searchResults.value = users.value.filter(u => 
                        u.nickname.toLowerCase() === query && 
                        u.login !== currentUser.value?.login &&
                        !friends.value.some(f => f.login === u.login)
                    ).map(u => ({
                        ...u,
                        kfg: calculateKFG(u)
                    }));
                }
                
                function addFriend(user) {
                    const newFriend = {
                        name: user.name,
                        surname: user.surname,
                        nickname: user.nickname,
                        login: user.login,
                        avatar: user.avatar
                    };
                    
                    friends.value.push(newFriend);
                    
                    const userIndex = users.value.findIndex(u => u.login === currentUser.value?.login);
                    if (userIndex !== -1) {
                        users.value[userIndex].friends = [...friends.value];
                        currentUser.value.friends = [...friends.value];
                    }
                    
                    searchResults.value = [];
                    friendSearchQuery.value = '';
                    searchPerformed.value = false;
                    
                    showMessage(`–î—Ä—É–≥ ${user.name} –¥–æ–±–∞–≤–ª–µ–Ω!`, 'success');
                    saveToStorage();
                }
                
                function removeFriend(friend) {
                    friends.value = friends.value.filter(f => f.login !== friend.login);
                    
                    const userIndex = users.value.findIndex(u => u.login === currentUser.value?.login);
                    if (userIndex !== -1) {
                        users.value[userIndex].friends = [...friends.value];
                        currentUser.value.friends = [...friends.value];
                    }
                    
                    showMessage(`–î—Ä—É–≥ ${friend.name} —É–¥–∞–ª–µ–Ω`, 'success');
                    saveToStorage();
                }
                
                // –û—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã
                let chart = null;
                
                function showMessage(text, type) {
                    message.text = text;
                    message.type = type;
                    message.show = true;
                    
                    setTimeout(() => {
                        message.show = false;
                    }, 3000);
                }
                
                function saveExpenses() {
                    const userIndex = users.value.findIndex(u => u.login === currentUser.value?.login);
                    if (userIndex !== -1) {
                        users.value[userIndex].expenses = { ...expenses };
                        currentUser.value.expenses = { ...expenses };
                    }
                    
                    saveToStorage();
                    showMessage('–†–∞—Å—Ö–æ–¥—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', 'success');
                    updateChart();
                }
                
                function saveToStorage() {
                    if (!currentUser.value) return;
                    
                    const userIndex = users.value.findIndex(u => u.login === currentUser.value?.login);
                    if (userIndex !== -1) {
                        users.value[userIndex] = { 
                            ...users.value[userIndex], 
                            ...currentUser.value,
                            expenses: { ...expenses },
                            goals: [...goals.value],
                            friends: [...friends.value]
                        };
                    }
                    
                    const data = {
                        users: users.value,
                        currentUser: currentUser.value,
                    };
                    localStorage.setItem('vueFinancialData', JSON.stringify(data));
                }
                
                function loadFromStorage() {
                    const saved = localStorage.getItem('vueFinancialData');
                    if (saved) {
                        try {
                            const data = JSON.parse(saved);
                            users.value = data.users || [];
                            
                            if (data.currentUser) {
                                const userExists = users.value.some(u => u.login === data.currentUser.login);
                                if (userExists) {
                                    currentUser.value = data.currentUser;
                                    loadUserData(data.currentUser);
                                }
                            }
                        } catch (e) {
                            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏', e);
                        }
                    }
                }
                
                function initChart() {
                    const ctx = document.getElementById('expenseChart');
                    if (!ctx) return;
                    
                    if (chart) {
                        chart.destroy();
                    }
                    
                    chart = new Chart(ctx.getContext('2d'), {
                        type: 'doughnut',
                        data: {
                            labels: Object.values(categoryNames),
                            datasets: [{
                                data: Object.values(filteredExpenses.value),
                                backgroundColor: [
                                    '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
                                    '#9966FF', '#FF9F40', '#FF6384', '#36A2EB',
                                    '#FFCE56', '#4BC0C0', '#FF8C42'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { position: 'bottom' }
                            }
                        }
                    });
                }
                
                function updateChart() {
                    if (chart) {
                        chart.data.datasets[0].data = Object.values(filteredExpenses.value);
                        chart.update();
                    } else {
                        initChart();
                    }
                }
                
                async function sendMessage() {
                    if (!chatInput.value.trim()) return;
                    
                    chatMessages.value.push({
                        text: chatInput.value,
                        sender: 'user'
                    });
                    
                    chatInput.value = '';
                    
                    setTimeout(() => {
                        if (chatContainer.value) {
                            chatContainer.value.scrollTop = chatContainer.value.scrollHeight;
                        }
                    }, 100);
                    
                    setTimeout(() => {
                        const responses = [
                            "–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –î–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –≤–µ—Å—Ç–∏ —É—á–µ—Ç –≤—Å–µ—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤.",
                            "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª–æ 50/30/20: 50% –Ω–∞ –Ω—É–∂–Ω–æ–µ, 30% –Ω–∞ –∂–µ–ª–∞–Ω–∏—è, 20% –≤ –∫–æ–ø–∏–ª–∫—É.",
                            "–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± —ç–∫–æ–Ω–æ–º–∏–∏ - –≥–æ—Ç–æ–≤–∏—Ç—å –¥–æ–º–∞ –∏ –±—Ä–∞—Ç—å –µ–¥—É —Å —Å–æ–±–æ–π.",
                            "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫—ç—à–±—ç–∫-—Å–µ—Ä–≤–∏—Å—ã –∏ —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –∞–∫—Ü–∏—è–º–∏ –≤ –º–∞–≥–∞–∑–∏–Ω–∞—Ö.",
                            "–û—Ç–ª–æ–∂–∏—Ç–µ 10% –¥–æ—Ö–æ–¥–∞ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è - —Ç–∞–∫ –≤—ã –Ω–µ –ø–æ—Ç—Ä–∞—Ç–∏—Ç–µ –∏—Ö.",
                            "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ –ø–ª–∞—Ç–∏—Ç–µ –ª–∏ –≤—ã –∑–∞ –Ω–µ–Ω—É–∂–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏."
                        ];
                        
                        chatMessages.value.push({
                            text: responses[Math.floor(Math.random() * responses.length)],
                            sender: 'bot'
                        });
                        
                        if (chatContainer.value) {
                            chatContainer.value.scrollTop = chatContainer.value.scrollHeight;
                        }
                    }, 1000);
                }
                
                function claimReward(reward) {
                    if (reward.kfgRequired <= kfg.value) {
                        showMessage(`–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –ø–æ–ª—É—á–∏–ª–∏: ${reward.name}`, 'success');
                    } else {
                        showMessage('–£ –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ö–§–ì –¥–ª—è —ç—Ç–æ–π –Ω–∞–≥—Ä–∞–¥—ã', 'error');
                    }
                }

                function getAvatarUrl(avatarId) {
                    const avatars = {
                        1: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Novice&backgroundColor=b6e3f4',
                        2: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Econom&backgroundColor=ffd5dc',
                        3: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Investor&backgroundColor=c0aede',
                        4: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Expert&backgroundColor=ffb347',
                        5: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Guru&backgroundColor=7ed4ad'
                    };
                    return avatars[avatarId] || avatars[1];
                }

                function getAvatarName(avatarId) {
                    const avatar = avatars.find(a => a.id === avatarId);
                    return avatar ? avatar.name : '–ù–æ–≤–∏—á–æ–∫';
                }

                function changeAvatar(avatar) {
                    if (isAvatarUnlocked(avatar)) {
                        const userIndex = users.value.findIndex(u => u.login === currentUser.value?.login);
                        if (userIndex !== -1) {
                            users.value[userIndex].avatar = avatar.id;
                            currentUser.value.avatar = avatar.id;
                            saveToStorage();
                            showMessage(`–ê–≤–∞—Ç–∞—Ä –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ ${avatar.name}!`, 'success');
                        }
                    } else {
                        showMessage(`–≠—Ç–æ—Ç –∞–≤–∞—Ç–∞—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω`, 'error');
                    }
                }
                
                function exportData() {
                    const data = {
                        user: currentUser.value,
                        expenses: { ...expenses },
                        goals: [...goals.value],
                        friends: friends.value,
                        exportDate: new Date().toISOString()
                    };
                    
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `financial_data_${new Date().toISOString().split('T')[0]}.json`;
                    a.click();
                    
                    showMessage('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!', 'success');
                }
                
                onMounted(() => {
                    loadFromStorage();
                    
                    setTimeout(() => {
                        initChart();
                    }, 100);
                });
                
                watch([expenses, goals, friends], () => {
                    if (currentUser.value) {
                        saveToStorage();
                    }
                }, { deep: true });

                // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤, –∞ –Ω–µ –ø—Ä–∏ –≤–≤–æ–¥–µ
                watch(kfg, (newKfg, oldKfg) => {
                    if (currentUser.value && oldKfg !== undefined && newKfg !== oldKfg) {
                        const currentAvatar = avatars.find(a => a.id === currentUser.value.avatar);
                        if (currentAvatar && !isAvatarUnlocked(currentAvatar)) {
                            changeAvatar(avatars[0]);
                            showMessage(`–í–∞—à –∞–≤–∞—Ç–∞—Ä –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ –ù–æ–≤–∏—á–æ–∫, —Ç–∞–∫ –∫–∞–∫ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Å—Ç–∞–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω`, 'info');
                        }
                    }
                });
                
                return {
                    currentTab,
                    message,
                    currentUser,
                    loginForm,
                    registerForm,
                    expenses,
                    goals,
                    newGoal,
                    friends,
                    friendSearchQuery,
                    searchResults,
                    searchPerformed,
                    chatMessages,
                    chatInput,
                    chatContainer,
                    rewards,
                    avatars,
                    tabs,
                    categoryNames,
                    categoryIcons,
                    totalExpenses,
                    totalIncome,
                    balance,
                    totalGoalsAmount,
                    totalSaved,
                    kfg,
                    recommendations,
                    penalties,
                    unlockedAvatars,
                    friendsWithKFG,
                    friendsWithDetails,
                    ratingParticipants,
                    showIncomeModal,
                    newIncomeValue,
                    filteredExpenses,
                    showAddToGoalModal,
                    selectedGoalName,
                    addToGoalAmount,
                    showRemoveGoalModal,
                    selectedGoalNameForRemove,
                    handleRegister,
                    handleLogin,
                    logout,
                    searchFriends,
                    addFriend,
                    removeFriend,
                    saveExpenses,
                    addGoal,
                    openAddToGoalModal,
                    closeAddToGoalModal,
                    confirmAddToGoal,
                    quickAddToGoal,
                    openRemoveGoalModal,
                    closeRemoveGoalModal,
                    confirmRemoveGoal,
                    sendMessage,
                    claimReward,
                    exportData,
                    getAvatarUrl,
                    getAvatarName,
                    changeAvatar,
                    isAvatarUnlocked,
                    isAvatarAvailableForRegister,
                    selectRegisterAvatar,
                    getAvatarStatus,
                    getMonthWord,
                    getUserRating,
                    getUserRatingLevel,
                    calculateKFG,
                    editIncome,
                    closeIncomeModal,
                    saveIncome
                };
            }
        });
        
        app.mount('#app');
    </script>
</body>
</html>
